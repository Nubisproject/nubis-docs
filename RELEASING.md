# Nubis - Release Management

This is a document that helps explain all the process involved in Release Management for the Nubis project. If you are not planning to make a Nubis release, you can safely ignore this document, unless you are curious.

## Milestones

Milestones are used to track a given Nubis release. Issues that will be part of that release will be assigned to the corresponding Milestone.

### Format

All Milestones will be [semantic versions](http://semver.org/) in the form of vn.n.n, where v stands for 'v'ersion, as per GitHub's recommended naming practices.

There can also be an extra postfix to the version number, added to describe the type or release this represents, i.e.

 * v1.0.0-beta
 * v1.2.3-devel
 * v1.5.5-preview

### Code names

 Release code-names might be exist, but will be used for purely cosmetic purposes. The *Happy Panda* release would just be a name for the v1.5.0 release.

### Managment

For each Milestone, one of the Tech Leads takes on the Release Manager Hat.

That Release Manager is responsible for triaging what makes it into that Release, with input from the rest of the team. 

Generally, it makes sense for each Milestone to represent a logical and descriptive amount of work. For example, a Milestone
could be about documentation, bug fixes, implementing a big new feature, refactoring, etc.

There is no specific defined time limit for a Milestone, but when it's created and issues triaged into it, it should be
factored in. Milestones that take too much time to complete are a bad practice. Better to split up work in multiple Milestones,
sequentially reached, instead of one big-bad Milestone.

For that Release, the Release Manager gains a veto, solely for purposed of tie-breaking project blocking/delaying issues.

The ultimate role of the Release Manager is to successfully complete the Milestone, with the help of the development team.

## Tags

Tags will be used to track releases of the Nubis Project.

All tags will be [semantic versions](http://semver.org/) in the form of vn.n.n, where v stands for 'v'ersion, as per GitHub's recommended naming practices.

All tags will be [GPG Signed](https://git-scm.com/book/tr/v2/Git-Tools-Signing-Your-Work) by the Release Manager, allowing anybody to verify their integrity.

Each Nubis repository is allowed to follow it's own minor release tagging schedule.

Major release bumps (i.e, from v0.9.2 to v1.0.0) will be coordinated across all repositories, to provide a consistent versioning scheme for each major Nubis Project release.

## Changelogs

Each repository will contain a CHANGELOG.md document, highlighting the changes between releases. It's a very common pattern
for software projects. However, maintaining ChangeLogs can quickly become tiresome.

To address this, all ChangeLogs for Nubis will be generated by [github_changelog_generator](https://github.com/skywinder/github-changelog-generator) during the release process.

The process is really simple and will look like this:

    $> github_changelog_generator --future-release v1.0.0 nubisproject/nubis-docs

## Cadence

For the time being, minor releases will not be on a schedule. They will be the responsibility of the respective
repository members, and we encourage the mentality of release often, release early.

Major releases, since they require coordination between repositories, will be less frequent. However, we are not
ready yet to commit to a specific time-based cadence. Major releases will happen organically, as we define and complete
the milestones for them.

## Announcing

Sometimes, like when making a new release, it can be desired to reach all Nubis Users. The current day-to-day mechanism to communicate with Nubis users is on the #nubis-users channel on irc.mozilla.org

However, for more official announcements, or information that needs more reasonable delivery guarantees than IRC, we use the [nubis-announce](https://groups.google.com/d/forum/nubis-announce) distribution list. It can be reached at [nubis-announce@googlegroups.com](nubis-announce@googlegroups.com)


## Process
When it comes time to create a release; all pull-requests related to this release have been merged, the chnagelog has been generated and all tests have passed, you are ready to cut a release.

This is the only time you will need to operate on an origin branch directly. This is different from the normal pull-request based work-flow in that tags can not be associated with a pull-request. Also this process is described using the master branch, you may wish to use a feature branch for your release work.

The first thing you will need to do is set up your branches in a manner similar to the following. That is one branch, I have called master, which is tracking your fork and one branch, I have called originmaster, tracking the master branch from the nubisproject origin. You can call these whatever you like, however these instructions will assume you have named them as shown here.

```bash
git branch -avv
* master        0645ce9 [tinnightcap/master] Update changelog for v0.9.0-beta1 release
  originmaster  7a8254d [origin/master] Merge pull request #8 from tinnightcap/master
```

Next you will need to ensure that your origin branch is current. Note that all pull-requests for this release need to have been merged onto the origin prior to this step. This includes having generated the changelog, committed it, created a pull-request, having had it code-reviewed and merged. Simply fetch and rebase.
```bash
git checkout master
git fetch origin
git rebase origin/master
```

Now we are ready to create the release using a signed tag as described [above](#tags). In this case I am creating a beta release for testing in advance of the v0.9.0 release.
```bash
git tag -s v0.9.0-beta -m"Tag beta release for upcoming v0.9.0 release"
```

Push the tag to your fork for testing. You should validate that the release files (.tar.gz & .zip) are working as expected and that there are no collisions or typos. You should be able to safely rename or delete tags from your fork, however once they are pushed to the origin they should no longer be deleted. You should ensure things are correct prior to continuing on to the next step. If you have any doubt, have your tags code-reviewed prior to continuing on.
```bash
git push --tags
```

Switch to the originmaster branch.
```bash
git checkout originmaster
```

Make sure this branch is up to date.
```bash
git pull
```

Finally push the signed tag to the origin.
```bash
git push --tags
```

That is it. You should verify once more that the release files are correct and send updates as appropriate.
